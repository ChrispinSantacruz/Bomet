<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Bomet Shooter - Leaderboard</title>
    <link rel="stylesheet" href="../css/main.css" />
    <link rel="icon" type="image/png" href="../images/personajes/vida.png" />

    <style>
        body {
            min-height: 100vh;
            min-width: 100vw;
            margin: 0;
            padding: 0;
            font-family: inherit;
            background: url('/images/background_leaderboards.png') center center/cover no-repeat;
            overflow-x: hidden;
        }

        /* Leaderboard Styles */
        .leaderboard-container {
            background: rgba(26, 26, 46, 0.9);
            backdrop-filter: blur(12px);
            border: 2px solid rgba(0, 255, 255, 0.3);
            box-shadow: 
                0 8px 32px rgba(0, 0, 0, 0.4),
                0 0 40px rgba(0, 255, 255, 0.2),
                inset 0 0 20px rgba(0, 255, 255, 0.05);
        }

        .leaderboard-entry {
            background: rgba(26, 26, 46, 0.6);
            border: 1px solid rgba(0, 255, 255, 0.2);
            transition: all 0.3s ease;
        }

        .leaderboard-entry:hover {
            background: rgba(26, 26, 46, 0.8);
            border-color: rgba(0, 255, 255, 0.4);
            transform: translateY(-2px);
            box-shadow: 0 4px 20px rgba(0, 255, 255, 0.2);
        }

        .leaderboard-entry.current-player {
            background: rgba(0, 255, 255, 0.1);
            border-color: #00FFFF;
            box-shadow: 
                0 0 20px rgba(0, 255, 255, 0.3),
                inset 0 0 20px rgba(0, 255, 255, 0.1);
        }

        .rank-badge {
            background: linear-gradient(135deg, #00FFFF 0%, #22D3EE 100%);
            box-shadow: 0 0 15px rgba(0, 255, 255, 0.4);
        }

        .rank-badge.gold {
            background: linear-gradient(135deg, #FFFF00 0%, #FDE047 100%);
            box-shadow: 0 0 15px rgba(255, 255, 0, 0.4);
            color: #0A0A1A;
        }

        .rank-badge.silver {
            background: linear-gradient(135deg, #E5E7EB 0%, #9CA3AF 100%);
            box-shadow: 0 0 15px rgba(229, 231, 235, 0.4);
            color: #0A0A1A;
        }

        .rank-badge.bronze {
            background: linear-gradient(135deg, #F59E0B 0%, #D97706 100%);
            box-shadow: 0 0 15px rgba(245, 158, 11, 0.4);
            color: #0A0A1A;
        }

        .score-display {
            font-family: 'JetBrains Mono', monospace;
            text-shadow: 0 0 10px currentColor;
        }

        .neon-button {
            background: linear-gradient(135deg, #00FFFF 0%, #22D3EE 100%);
            box-shadow: 
                0 4px 20px rgba(0, 0, 0, 0.3),
                0 0 20px rgba(0, 255, 255, 0.3);
            transition: all 0.3s ease;
        }

        .neon-button:hover {
            transform: translateY(-2px) scale(1.02);
            box-shadow: 
                0 6px 25px rgba(0, 0, 0, 0.4),
                0 0 30px rgba(0, 255, 255, 0.5),
                0 0 50px rgba(0, 255, 255, 0.2);
        }

        .neon-button:active {
            transform: translateY(0) scale(0.98);
            transition-duration: 0.1s;
        }

        /* Title Animation */
        .title-glow {
            text-shadow: 
                0 0 10px #00FFFF,
                0 0 20px #00FFFF,
                0 0 30px #00FFFF,
                0 0 40px #00FFFF;
            animation: title-pulse 3s ease-in-out infinite alternate;
        }

        @keyframes title-pulse {
            0% { 
                text-shadow: 
                    0 0 10px #00FFFF,
                    0 0 20px #00FFFF,
                    0 0 30px #00FFFF;
            }
            100% { 
                text-shadow: 
                    0 0 15px #00FFFF,
                    0 0 25px #00FFFF,
                    0 0 35px #00FFFF,
                    0 0 45px #00FFFF;
            }
        }

        /* Fade In Animation */
        .fade-in {
            animation: fadeIn 1s ease-out forwards;
        }

        .fade-in-delay {
            animation: fadeIn 1.5s ease-out forwards;
        }

        .fade-in-delay-2 {
            animation: fadeIn 2s ease-out forwards;
        }

        @keyframes fadeIn {
            from { 
                opacity: 0;
                transform: translateY(30px);
            }
            to { 
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Empty State Styles */
        .empty-state {
            background: rgba(26, 26, 46, 0.6);
            border: 2px dashed rgba(0, 255, 255, 0.3);
        }

        /* Leaderboard Responsive Positioning */
        .leaderboard-responsive {
            max-width: 35vw;
            min-width: 400px;
            margin: 12vh 0 0 7vw;
            position: relative;
        }

        /* Desktop adjustments */
        @media (min-width: 1200px) {
            .leaderboard-responsive {
                max-width: 30vw;
                min-width: 450px;
                margin: 15vh 0 0 4vw; /* Movido 5% más a la izquierda (9vw → 4vw) */
            }
        }

        @media (min-width: 1400px) {
            .leaderboard-responsive {
                max-width: 25vw;
                min-width: 500px;
                margin: 18vh 0 0 6vw; /* Movido 5% más a la izquierda (11vw → 6vw) */
            }
        }

        /* Tablet adjustments */
        @media (max-width: 1024px) and (min-width: 769px) {
            .leaderboard-responsive {
                max-width: 45vw;
                min-width: 350px;
                margin: 10vh 0 0 4vw;
            }
        }

        /* Mobile Optimizations */
        @media (max-width: 768px) {
            .leaderboard-responsive {
                max-width: 90vw;
                min-width: 280px;
                margin: 8vh 1rem 0 1rem;
                left: auto;
                transform: none;
            }
            
            .leaderboard-container {
                padding: 1.5rem;
            }
            
            .leaderboard-entry {
                padding: 1rem;
            }
            
            .rank-badge {
                width: 2.5rem;
                height: 2.5rem;
                font-size: 0.875rem;
            }
        }
    </style>
<script type="module" src="https://static.rocket.new/rocket-web.js?_cfg=https%3A%2F%2Fbometshoo6010back.builtwithrocket.new&_be=https%3A%2F%2Fapplication.rocket.new&_v=0.1.8"></script>
</head>
<body class="min-h-screen flex flex-col items-center justify-center font-body">

    <script>
        // Set backend URL to the deployed Render service
        window.__BACKEND_URL__ = 'https://bomet-backend.onrender.com';
        console.log('Backend URL configured:', window.__BACKEND_URL__);
    </script>

    <!-- Back Button -->
    <a href="welcome.html" style="position:absolute;top:24px;left:24px;z-index:10;background:none;box-shadow:none;padding:0;border:none;width:auto;height:auto;">
        <img src="../images/buttons/boton_back.png" alt="Back to Menu" style="width:160px;height:auto;display:block;" />
    </a>

    <!-- Main Container -->
    <div class="w-full max-w-4xl mx-auto px-4 py-8 fade-in">


        <!-- Leaderboard Container (centrado responsivo) -->
        <div class="leaderboard-container rounded-xl p-6 md:p-8 mb-8 fade-in-delay leaderboard-responsive">
            <div id="leaderboardContent">
                <!-- Leaderboard entries will be populated by JavaScript -->
            </div>
        </div>



        <!-- Footer -->
        <div class="text-center mt-12">
            <p class="text-text-secondary/50 text-sm">
                © 2025 Bomet Shooter. All rights reserved.
            </p>
        </div>
    </div>

    <!-- JavaScript -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            loadLeaderboard();
        });

    async function loadLeaderboard() {
            const leaderboardContent = document.getElementById('leaderboardContent');
            const currentPlayer = localStorage.getItem('bometPlayerName');
            
            // Try fetching scores from backend (absolute or relative); fall back to localStorage
            let scores = [];
            try {
                const backend = window.__BACKEND_URL__ || '';
                let resp;
                if (backend) {
                    // explicit backend URL provided (e.g. http://localhost:3000)
                    resp = await fetch(backend + '/api/leaderboard?limit=5');
                } else {
                    // try same-origin API (works when backend serves the frontend)
                    resp = await fetch('/api/leaderboard?limit=5');
                }

                if (resp && resp.ok) {
                    scores = await resp.json();
                    // Backend is authoritative: remove any stale local entries
                    try { localStorage.removeItem('bometLeaderboard'); } catch (e) { /* ignore */ }
                } else {
                    // fallback to localStorage
                    const storedScores = localStorage.getItem('bometLeaderboard');
                    if (storedScores) scores = JSON.parse(storedScores);
                }
            } catch (error) {
                console.error('Error loading leaderboard from backend/localStorage:', error);
                const storedScores = localStorage.getItem('bometLeaderboard');
                if (storedScores) scores = JSON.parse(storedScores);
            }

            // Sort scores in descending order and take top 5
            scores.sort((a, b) => b.score - a.score);
            const topScores = scores.slice(0, 5);

            if (topScores.length === 0) {
                // Show empty state
                leaderboardContent.innerHTML = `
                    <div class="empty-state rounded-lg p-12 text-center">
                        <div class="mb-6">
                            <svg class="w-16 h-16 mx-auto text-text-secondary/40" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4M7.835 4.697a3.42 3.42 0 001.946-.806 3.42 3.42 0 014.438 0 3.42 3.42 0 001.946.806 3.42 3.42 0 013.138 3.138 3.42 3.42 0 00.806 1.946 3.42 3.42 0 010 4.438 3.42 3.42 0 00-.806 1.946 3.42 3.42 0 01-3.138 3.138 3.42 3.42 0 00-1.946.806 3.42 3.42 0 01-4.438 0 3.42 3.42 0 00-1.946-.806 3.42 3.42 0 01-3.138-3.138 3.42 3.42 0 00-.806-1.946 3.42 3.42 0 010-4.438 3.42 3.42 0 00.806-1.946 3.42 3.42 0 013.138-3.138z"/>
                            </svg>
                        </div>
                        <h3 class="text-xl font-heading font-bold text-text-primary mb-3">
                            No scores yet!
                        </h3>
                        <p class="text-text-secondary mb-6">
                            Be the first to set a record.<br>
                            Play now and show off your piloting skills!
                        </p>
                        <div class="flex justify-center items-center space-x-4 text-sm text-text-secondary/60">
                            <span>🚀 Escape Area 51</span>
                            <span>•</span>
                            <span>⭐ Earn points</span>
                            <span>•</span>
                            <span>🏆 Climb the leaderboard</span>
                        </div>
                    </div>
                `;
            } else {
                // Show leaderboard entries
                let leaderboardHTML = '<div class="space-y-4">';
                
                topScores.forEach((entry, index) => {
                    const rank = index + 1;
                    const isCurrentPlayer = entry.playerName === currentPlayer;
                    const formattedScore = formatScore(entry.score);
                    const formattedDate = formatDate(entry.date);
                    
                    let rankBadgeClass = 'rank-badge';
                    let rankIcon = rank;
                    
                    if (rank === 1) {
                        rankBadgeClass += ' gold';
                        rankIcon = '👑';
                    } else if (rank === 2) {
                        rankBadgeClass += ' silver';
                        rankIcon = '🥈';
                    } else if (rank === 3) {
                        rankBadgeClass += ' bronze';
                        rankIcon = '🥉';
                    }

                    leaderboardHTML += `
                        <div class="leaderboard-entry ${isCurrentPlayer ? 'current-player' : ''} rounded-lg p-4 flex items-center justify-between">
                            <div class="flex items-center space-x-4">
                                <div class="font-bold text-base text-primary" style="min-width:2em;text-align:center;">
                                    ${rank <= 3 ? rankIcon : rank}
                                </div>
                                <div>
                                    <h3 class="font-heading font-bold text-base text-text-primary ${isCurrentPlayer ? 'text-primary' : ''}" style="word-break:break-all;">
                                        ${entry.playerName}
                                        ${isCurrentPlayer ? '<span class=\"text-xs font-normal text-primary/80 ml-2\">(You)</span>' : ''}
                                    </h3>
                                    <!-- Fecha eliminada -->
                                </div>
                            </div>
                            <div class="text-right">
                                <div class="score-display text-2xl font-bold text-accent">
                                    ${formattedScore}
                                </div>
                                <div class="text-text-secondary text-sm">
                                    points
                                </div>
                            </div>
                        </div>
                    `;
                });
                
                leaderboardHTML += '</div>';
                leaderboardContent.innerHTML = leaderboardHTML;
            }
        }

        function formatScore(score) {
            // US number formatting (1,000.00)
            return score.toLocaleString('en-US');
        }

        function formatDate(dateString) {
            if (!dateString) return 'Unknown date';
            
            try {
                const date = new Date(dateString);
                const now = new Date();
                const diffTime = Math.abs(now - date);
                const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                
                if (diffDays === 1) {
                    return 'Today';
                } else if (diffDays === 2) {
                    return 'Yesterday';
                } else if (diffDays <= 7) {
                    return `${diffDays - 1} days ago`;
                } else {
                    return date.toLocaleDateString('en-US', {
                        day: '2-digit',
                        month: '2-digit',
                        year: 'numeric'
                    });
                }
            } catch (error) {
                return 'Unknown date';
            }
        }

        // Sample data initialization removed so backend can provide authoritative leaderboard entries.
        function initializeSampleData() {
            // Disabled: do not populate localStorage with sample scores.
        }

        // Refresh leaderboard when page becomes visible (in case scores were updated in another tab)
        document.addEventListener('visibilitychange', function() {
            if (!document.hidden) {
                loadLeaderboard();
            }
        });

        // Add keyboard navigation
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape' || e.key === 'Backspace') {
                window.location.href = 'welcome.html';
            }
        });

        // Initialize audio system when page loads
        document.addEventListener('DOMContentLoaded', function() {
            // El nuevo sistema se activará automáticamente con la primera interacción
            console.log('Leaderboard page loaded - audio will be enabled on first user interaction');
        });
    </script>
    <!-- Audio System -->
    <script>
        // Simple and reliable path detection for Live Server from pages/ directory
        function getScriptPath(scriptPath) {
            // When Live Server runs from pages/ directory, we need to go up one level
            // Check if we're in pages/ directory by looking at the current pathname
            const currentPath = window.location.pathname;
            const isInPagesDir = currentPath.includes('/pages/') || currentPath.endsWith('.html');
            
            if (isInPagesDir) {
                // We're in pages/ directory, so audio scripts are in ../js/
                return '../js/' + scriptPath.replace(/^\/js\//, '');
            } else {
                // We're in root, so audio scripts are in js/
                return 'js/' + scriptPath.replace(/^\/js\//, '');
            }
        }
        
        // Load scripts with correct paths
        function loadScript(src) {
            const script = document.createElement('script');
            script.src = getScriptPath(src);
            console.log('Loading script from:', script.src);
            script.onerror = () => console.warn('Failed to load script:', src, 'from', script.src);
            document.head.appendChild(script);
            return new Promise((resolve) => {
                script.onload = resolve;
            });
        }
        
        // Load scripts sequentially
        loadScript('/js/audioManager.js').then(() => {
            loadScript('/js/muteButton.js');
        });
    </script>
<script id="dhws-dataInjector" src="/dhws-data-injector.js"></script>
</body>
</html>